# 매개변수가 유효한지 검사하라

메서드와 생성자 대부분은 **입력 매개변수의 값이 특정 조건을 만족**하기를 바란다. 이런 **제약**은 반드시 **문서화**해야 되며, 메서드가 실행되기 전에 검사해야 한다.

메서드가 실행되기 전에 매개변수를 확인한다면 잘못된 값이 넘어왔을 때 즉각적이고 깔끔한 방식으로 예외를 일으킬 수 있다.

<br>



### 매개변수 제약 문서화 가이드

* **`public`, `protected` 메서드는 매개변수 값이 잘못되었을 때 던지는 예외를 문서화해야 한다.**

  * `@throw` 자바독 태그를 사용하면 된다.

* **매개변수의 제약을 문서화한다면 그 제약을 어겼을 때 발생하는 예외도 함께 기술해야 한다.**

  ```java
  /**
   * (현재 값 mod m) 값을 반환한다. 
   * 이 메서드는 항상 음이 아닌 BigInteger를 반환한다는 점에서 remainder 메서드와 다르다.
   * 
   * @param m 계수 (양수여야 한다.)
   * @return 현재 값 mod m
   * @throws ArithmeticException m이 0보다 작거나 같으면 발생한다.
   */
  public BigInteger mod(BigInteger m) {
      if(m.signum() <= 0) 
          throw new ArithmeticException("계수 (m)는 양수여아 합니다." + m);
      ... // 계산 수행
  }
   
  ```

  * `m`이 `null` 이면 `m.signnum()` 을 호출할 때, `NullPointerException`을 던진다. 하지만 클래스 수준에서 설명을 기술했기 때문에 이와 관련된 내용을 문서에서 찾을 수 없다.
  * 클래스 수준 주석은 그 클래스의 모든 `public` 메서드에 적용되므로 각 메서드에 일일이 기술하는 것보다 훨씬 깔끔하다.
  * `@Nullable`이나 이와 비슷한 어노테이션을 사용해 특정 매개변수는 `null`이 될 수 있다고 알려줄 수 있지만, 표준적인 방법은 아니다. 

* **`java.util.Objects.requireNull`**

  ```java
  this.strategy = Object.requireNotNull(strategy, "전략");
  ```

  * `null` 검사를 수동으로 하지 않아도 된다.
  * 입력을 그대로 반환하므로 값을 사용하는 동시에 `null` 검사를 할 수 있다.
  * 자바 9에서는 `Objects`에 범위 검사 기능이 추가되었다. 
    * `CheckFromIndexSize`, `checkFromToIndex`, `checkIndex`
    * `null` 검사 메서드만큼 유연하지는 않지만, 제약이 걸림돌이 되지 않는 상황에서는 아주 유용하게 사용할 수 있다.

* **공개되지 않은 메서드라면 패키지 제작자가 메서드가 호출되는 상황을 통제하여 유효한 값만이 메서드에 넘기는 것을 보증할 수 있다.**

  * `public`이 아닌 메서드라면 단언문(`assert`)을 사용해 매개변수 유효성을 검증할 수 있다.

    ```java
    public static void sort(long a[], int offset, int length) {
        assert a != null;
        assert offset >= 0 && offset <= a.length;
        assert length >= 0 && length <= a.length - offset;
        ... // 계산 수행
    }
    ```

    * 자신이 단언한 조건은 무조건 참이라고 선언한다.
    * 단언문은 일반적인 유효성 검사와 다르다.
      * 실패하면 `AssertError`를 던진다.
      * 런타임에 아무런 효과도, 성능 저하도 없다.
        * 단, java를 실행할 때, 명령줄에서 `-ea` 혹은 `--enableassertion` 플래그를 설정하면 런타임에 영향을 준다.

* 메서드가 직접 사용하지 않으나 나중에 쓰기 위해 저장하는 매개변수는 특히 더 신경 써서 검사해야 한다.

<br>

### 매개변수 설계 주의점

* **메서드**는 **최대한 범용적으로 설계**해야 한다.
* 메서드가 건내 받은 값으로 무언가 제대로 된 일을 할 수 있다면 매개변수 제약은 적을수록 좋다. 하지만 구현하려는 개념 자체가 특정한 제약을 내재한 경우도 드물지 않다.

<br>

### 정리

* **메서드나 생성자를 작성**할 때는 그 매개변수들에 **어떤 제약이 있을지 생각**해야 한다.
* 그 **제약**들을 **문서화**하고 메서드 코드 시작 부분에서 명시적으로 **검사**하는 습관을 기르자.